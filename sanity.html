<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sanity check</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;padding:24px}
    pre{background:#0f172a;color:#e2e8f0;padding:16px;border-radius:12px;white-space:pre-wrap}
  </style>
</head>
<body>
  <h1>Sanity check</h1>
  <pre id="out">טוען…</pre>

  <script type="module">
    import "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";
    import "./supabaseClient.js"; // זה הקובץ שלך

    const out = document.getElementById('out');

    function log(obj){ out.textContent = JSON.stringify(obj, null, 2); }

    // בדיקה 1: הספרייה נטענה
    const libReady = !!window.supabase && typeof window.supabase.createClient === 'function';

    try {
      // ממתין שה-client יקום (מה-supabaseClient.js)
      const ready = await window.supabaseReady;
      if (!ready.ok) throw ready.error;

      // בדיקה 2: קריאת DB אמיתית (סופרת לקוחות)
      const { data, error } = await window.supabase.client
        .from('customers')
        .select('id', { count: 'exact', head: true });

      log({
        cdn_loaded: libReady,
        client_bootstrapped: ready.ok,
        query: error ? 'ERROR' : 'OK',
        error: error ?? null,
        count: (data === null && !error) ? 'OK (count only)' : data
      });
    } catch (e) {
      log({ cdn_loaded: libReady, client_bootstrapped: false, error: String(e) });
    }
  </script>
</body>
</html>
